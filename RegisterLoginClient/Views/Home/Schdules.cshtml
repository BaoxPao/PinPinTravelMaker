@*Header*@
@section Styles {


}
@*Body*@
@*-Head-*@
<head>
</head>

@*-Main-*@
<button id="btnGetAll" class="btn btn-success">全部紀錄</button>
<table id="sch_list" class="table table-striped">
    <thead>
        <tr>
            <th id="sch_name" scope="col">行程名稱</th>
            <th id="sch_startdate" scope="col">出發日期</th>
            <th id="sch_enddate" scope="col">結束日期</th>
            <th id="sch_creatdate" scope="col">建立日期</th>
            <th id="sch_username" scope="col">編輯者</th>
        </tr>
    </thead>
    <tbody id="sch_alldetails">
    </tbody>
</table>
@*-Footer-*@
<footer></footer>


@*-JS-*@
@section Scripts {
    <script>
        $(document).ready(function () {
            //document start
            var baseaddress = "https://localhost:7280";



            //全部紀錄_非同步GET
            $("#btnGetAll").on("click", async function () {
                //alert('good');
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('No token found. Please log in.');
                    return;
                }

                try {
                    var result = await fetch(`${baseaddress}/api/Schedules`, {
                        method: "GET",
                        headers: {
                            'Authorization': `bearer ${token}` //token放在headers，Bearer+token可解密
                        }
                    });
                    var data = await result.json();
                    // 清空表格的tbody
                    $("#sch_alldetails").empty();
                    // 遍历JSON数据并将其插入到表格中
                    data.forEach(item => {
                        const createdAtFormatted = new Date(item.createdAt).toLocaleDateString();
                        var row = `<tr>
                                            <td><a>${item.name}</a></td>
                                            <td>${item.startTime}</td>
                                            <td>${item.endTime}</td>
                                            <td>${createdAtFormatted}</td>
                                            <td>${item.userName}</td>
                                            </tr>`;
                        $("#sch_alldetails").append(row);
                    });
                }
                catch (error) {
                    console.error("Error fetching data:", error);
                }
            });

            //全部紀錄_非同步Post
            // $("#btnGetAll").on("click", async function () {
            //     try {


            //     }
            //     catch {

            //     }
            // };




            //             //document end
        });
    </script>
}
