
<link href="~/css/owl.theme.default.css" type="text/css" rel="stylesheet" asp-append-version="true" />
<link href="~/css/owl.carousel.css" type="text/css" rel="stylesheet" asp-append-version="true" />
<link href="~/lib/air-datepicker-3/air-datepicker-3/dist/air-datepicker.css" type="text/css" rel="stylesheet" asp-append-version="true" />
@* <link href="~/css/schedule_styles.css" rel="stylesheet" /> *@
<link href="~/css/popular_courses_slider.css" rel="stylesheet" />
<link href="~/css/serchinput.css" type="text/css" rel="stylesheet" asp-append-version="true" />
<link href="~/css/tabs_style.css" type="text/css" rel="stylesheet" />



<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.7/umd/popper.min.js"></script>
<script src="~/lib/air-datepicker-3/air-datepicker-3/dist/air-datepicker.js" type="text/javascript" asp-append-version="true"></script>
<script src="~/lib/air-datepicker-3/air-datepicker-3/dist/locale/en.js" type="text/javascript" asp-append-version="true"></script>
<script src="~/lib/air-datepicker-3/air-datepicker-3/dist/locale/zh.js" type="text/javascript" asp-append-version="true"></script>
<script src="https://kit.fontawesome.com/66638a3835.js" crossorigin="anonymous"></script>
<script src="~/js/owl.carousel.js" type="text/javascript"></script>
<script src="~/js/coursescard.js" type="text/javascript"></script>
<script src="~/js/popular_courses_slider.js" type="text/javascript"></script>
<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyCV7zooAQnROJE-aQusJjkCln2GZGsHrcg&loading=async&callback=initMap">
</script>

@section Styles{
    <style>
    #serachrow {
        width: 45%;
        margin-left: 0;
        margin-right: auto;
    }

    .air-datepicker {
        z-index: 9999; /* 你可以根據實際情況調整這個值 */
    }
    
    #errmsg {
        color: red;
        display: none; /* 默认隐藏 */
    }

    course_card{
        background: #D8D8D8;
    }

    #createbtn, #newschbtn {
    background:#006030;
        color: #F0F0F0;
}

    #newschbtn:hover, #createbtn:hover {
    background: #F0F0F0;
    color:#006030;
        border-bottom: 1px solid #7B7B7B;
    }

    .pac-container {
        z-index: 9999 !important;
    }

    #addnewcard {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
        transition: box-shadow 0.3s ease-in-out;
        border-radius:6px
    }

    #addnewcard img {
        width: 150px;
        height: 255px;
        object-fit: cover;
    }

    #addnewcard:hover{
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .header_search_container input{
        margin-right:-3px;
    }

    .item course_card_owl_item:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .edit_btn{
            text-decoration: none;
    }

    .course_card_link {
    display: block;
    text-decoration: none; /* 移除下划线 */
    color: inherit; /* 继承父元素的文字颜色 */
    transition: all 0.3s ease; /* 平滑过渡效果 */
    }

    /* 悬停效果 */
    .course_card_link:hover {
    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.2); /* 悬停时阴影效果 */
    border-radius:14px;
    }



    

</style>
}

@*Header End*@

@*Body*@
    @*-搜尋-*@
    @* <div class="container search_container pb-1">
        <div class="row">
            <div class="header_right d-flex flex-row align-items-center justify-content-end w-100">
                <div class="header_search_container position-relative">
                    <form class="header_search_form d-flex align-items-center" action="#">
                        <input id="header_search_input" class="search_input" type="text" v-model="name" placeholder="搜尋?">
                        <button class="header_search_btn position-absolute" type="button">
                            <img src="/images/icon_search.png" alt="">
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </div> *@
    @*-顯示schedule-*@
    <div class="container-fluid">
        <div class="row">        
            <div class="tab-wrap">                
            <input type="radio" id="tab1" name="tabGroup1" class="tab" checked>
            <label for="tab1"><img src="~/images/subtitle_icon_1.png" />我的行程</label>
            <input type="radio" id="tab2" name="tabGroup1" class="tab">
            <label for="tab2">旅遊群組</label>
                @*--tabGroup1:我的行程--*@
                <div class="tab__content">
                    @*--ERROR MESSAGE，未來再用SWEETALERT--*@
                    <div id="errmsg"></div>
                    <div class="popular" id="result_container">
                        <div class="row" style="margin-top:1px;margin-bottom:2px">
                            <div class="section_title_container mb-3">
                                    <div class="d-flex flex-row align-items-center">
                                        <button id="newschbtn" type="button" class="btn" data-bs-toggle="modal" data-bs-target="#newschdule">
                                            新增行程
                                        </button>
                                    </div>
                            </div>
                        </div>
                        <div class="row course_cards_container section_content_row">
                            <div class="col">
                                <div class="popular_courses_slider_container">
                                    <div class="owl-carousel owl-theme popular_courses_slider" id="course-container">
                                        <!--Add New Course Card-->
                                        <!--foreach schedule Course Card -->
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @*--tabGroup2:旅遊群組--*@
                <div class="tab__content">
                    <h3>旅遊群組</h3>
                    <p>Praesent nonummy mi in odio. Nullam accumsan lorem in dui. Vestibulum turpis sem, aliquet eget, lobortis pellentesque, rutrum eu, nisl. Nullam accumsan lorem in dui. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu.</p>

                    <p>In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Morbi mattis ullamcorper velit. Pellentesque posuere. Etiam ut purus mattis mauris sodales aliquam. Praesent nec nisl a purus blandit viverra.</p>
                </div>
            </div>
            
            
        </div>
    </div>
    @*-新增行程Modal-*@
    <div class="modal fade" id="newschdule" tabindex="-1" aria-labelledby="newschduleLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title w-100 text-center" id="newschduleLabel">建立新行程</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="container-fluid modal-body">
                <form id="newschdule" class="needs-validation" method="post" novalidate autocomplete="off">
                    <!-- 行程 -->
                    <div class="mb-3">
                        <label for="Name" class="form-label mb-2">行程名稱</label>
                        <input id="Name" type="text" class="form-control mb-1" name="Name" placeholder="新的名稱" v-model="newSchedule.name" required>
                        <label for="search_input" class="form-label mb-2">目的地</label>
                        <input id="search_input" type="text" class="form-control mb-1" placeholder="目的地" required>
                    </div>
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-5">
                                <input type="text" name="StartTime" id="el1" class="form-control text-center" placeholder="開始日期" v-model="newSchedule.startTime" />
                            </div>
                            <div class="col-2 text-center align-center pt-1 pb-1">
                                <i class="fa-solid fa-arrow-right fa-xl"></i>
                            </div>
                            <div class="col-5">
                                <input type="text" name="EndTime" id="el2" class="form-control text-center" placeholder="結束日期" v-model="newSchedule.endTime" />
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="createbtn" v-on:click="createSchedule">完成</button>
            </div>
        </div>
    </div>
</div>
    @*-token即將失效通知modal-*@
    
    @*-token失效，user重登入modal-*@
</div>

@section Scripts {
        <script>
            $(document).ready(async function () {
                 @*-載入行程-*@
                    var baseAddress = "https://localhost:7280";
                    var token = localStorage.getItem('token');
                    $('#errmsg').hide();

           
                    try {
                        var response = await fetch(`${baseAddress}/api/Schedules`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        if (!response.ok) {
                            $('#result_container').hide();
                            alert('導向login畫面');
                            return;
                        }
                        var data = await response.json();
                        renderCourses(data);
                    } 
                    catch (error) {
                        console.log(error);
                        $('#result_container').hide();
                        $('#errmsg').show();
                        $('#errmsg').text('Error: ' + error.message);
                    };

                @*-進入行程編輯頁面-*@
                    $('.edit_btn').on('click', function () {
                        alert('entrydetail page');
                    });

               

                @*-新增行程視窗-*@
                    $('#newschdule').on('shown.bs.modal', function () {
                        initMap();
                    });
        
                    
                @*-function area-*@
                    @*--Google Autocomplete--*@
                    function initMap() {
                        let search_input = document.getElementById('search_input');
                        if (!search_input) {
                            console.error("Input element not found");
                            return;
                        }

                        let autocomplete = new google.maps.places.Autocomplete(search_input, {
                            types: ['geocode']
                        });

                        google.maps.event.addListener(autocomplete, 'place_changed', function () {
                            let place = autocomplete.getPlace();
                            if (!place.geometry) {
                                console.error("No details available for input: '" + place.name + "'");
                                return;
                            }
                            let latitude = place.geometry.location.lat();
                            let longitude = place.geometry.location.lng();

                            console.log('Selected place details:', place);
                            console.log('Latitude:', latitude);
                            console.log('Longitude:', longitude);
                        });
                    }


                   
                       
            });
    </script>
}
