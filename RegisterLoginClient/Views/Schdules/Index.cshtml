@*Header*@
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<style>
        #serachrow {
            width:45%;
            margin-left: 0;
            margin-right: auto;
        }

        a:hover{
            border:1px solid navy;
        }
</style>

@*Header End*@

@*Body*@
<div id="app" class="container">
    <div class="row mb-3" id="serachrow">
        <div class="col-md-5 d-flex justify-content-between">
            <input type="text" class="form-control" v-model="name" placeholder="請輸入您要查找的行程" />
        </div>
        <div class="col-md-5 d-flex justify-content-between">
            <button class="btn btn-primary btn-sm mx-1" v-on:click="findSchdule(name)">搜尋行程</button>
        </div>
    </div>
    @*-BoostrapCard*@
    <div class="mb-3" id="resultcard">
        <div class="row">
            <div class="col-md-4" v-for="schedule in schedules">
                @*--更新--*@
                <template v-if="schedule.Edit == true && !errorMessage">
                    <div class="card mb-2">
                        <div class="mt-2 d-flex justify-content-center">
                            @* <img class="card-img-top mb-1" /> *@
                        </div>
                        <div class="card-body mb-3 align-content-center">
                            <h3 class="card-title">{{ schedule.name }}</h3>
                            <span class="card-text">{{ schedule. startTime }}</span>
                            <span> → </span>
                            <span class="card-text">{{ schedule.endTime }}</span>
                        </div>
                        <a href="#" class="stretched-link"></a>
                    </div>
                </template>
                @*-- 搜尋結果-- *@
                <template v-else>
                    <div class="card mb-2">
                            <div class="mt-2 d-flex justify-content-center">
                                @* <img class="card-img-top mb-1" /> *@
                            </div>
                            <div class="card-body mb-3 align-content-center">
                                <h3 class="card-title">{{ schedule.name }}</h3>
                                <span class="card-text">{{ schedule. startTime }}</span>
                                <span> → </span>
                                <span class="card-text">{{ schedule.endTime }}</span>                           
                            </div>
                            <a href="#" class="stretched-link"></a>
                        </div>
                </template>
            </div>
        </div>
    </div>
    <div v-if="errorMessage" class="unvailed">{{ errorMessage }}</div>
</div>

@*-Scripts-*@
 
    <script src="https://unpkg.com/vue@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.2/axios.min.js"
            integrity="sha512-JSCFHhKDilTRRXe9ak/FJ28dcpOJxzQaCd3Xg8MyF6XFjODhy/YMCM8HW0TFDckNHWUewW+kfvhin43hKtJxAw=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://kit.fontawesome.com/66638a3835.js" crossorigin="anonymous"></script>
    <script>
        try {
            var vueApp = {
                data() {
                    return {
                        token: localStorage.getItem('token'),
                        baseAddress: "https://localhost:7280",
                        name: "",
                        startTime: "",
                        endTime: "",
                        schedules: [],
                        errorMessage:""
                    };
                },
                mounted() {
                    this.getSchedule();
                },
                methods: {
                    getSchedule: function () {
                        let _this = this;
                        var request = {
                            name: _this.name,
                            startTime: _this.startTime,
                            endTime: _this.endTime
                        };
                        axios.get(`${_this.baseAddress}/api/Schedules`, {
                            headers: {
                                'Authorization': `Bearer ${_this.token}`
                            },request
                        }).then((response) => {
                            console.log(response);
                            _this.schedules = response.data;
                            _this.errorMessage = ""; 
                            for (var i = 0; i < _this.schedules.length; i++) {
                                _this.schedules.Edit = false;
                            }
                            $('#resultcard').show();
                        }).catch((error) => {
                            console.error(err);
                        });
                    },
                    showModal: function () {
                        alert("Addsch");
                    },
                    findSchdule: function () {
                        let _this = this;
                        var request = {
                            name: _this.name,
                            startTime: _this.startTime,
                            endTime: _this.endTime
                        };
                        axios.get(`${_this.baseAddress}/api/Schedules/${_this.name}`, {
                            headers: {
                                'Authorization': `Bearer ${_this.token}`
                            }, request
                        }).then((response) => {
                            _this.schedules = response.data;
                            _this.errorMessage = ""; // 清空错误信息
                            $('#resultcard').show(); // 显示结果卡片
                        }).catch((error) => {
                            if (error.response && error.response.status === 404) {
                                //alert('查無相關行程');
                                try {
                                    $('#resultcard').hide();
                                    _this.errorMessage = '查無相關行程';
                                }
                                catch (err) { 
                                console.log(`400:${err}`)
                                }
                                    
                            } else {
                                console.error(error);
                            }
                        });
                    }
                }
            };
            var app = Vue.createApp(vueApp).mount('#app');
        } catch (e) { 
            console.log(e);
        }
    </script>

@*Body End*@

